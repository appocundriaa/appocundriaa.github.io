<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marco Marino</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <header class="header">
    <div class="header-grid">
      <div></div>

      <div class="header-content">

        <!-- TESTO: NON MODIFICARE -->
        <p id="bioSource" class="sr-only">
È un Sironi! Tra i più famosi. Pubblicato su tutti i cataloghi. È del periodo pessimista! Il più raro. Questo se t'o attacchi in ufficio c'hai uno scatto da così a così! Te lo metti in casa, fai un figurone! Io ce l'ho avuto in salotto per vent'anni, tu non sai quanto m'ha aiutato a me, le serate che m'ha risolto... perché è anche un argomento di conversazione, sai? C'è pure chi dice: se c'ha 'e zinne viola, de che colore c'avrà er culo?
        </p>

        <!-- T-SHIRT -->
        <div class="tshirt-wrap" aria-label="Testo dentro una maglietta">
          <svg id="tshirtSvg" class="tshirt-svg" viewBox="0 0 512 512" role="img" aria-label="T-shirt text">
            <defs>
              <!--
                SHAPE: usa SOLO come clip (invisibile).
                NIENTE COLLO. NIENTE BORDO VISIBILE.
              -->
              <clipPath id="tshirtInnerClip" clipPathUnits="userSpaceOnUse">
                <path id="tshirtInnerPath" d="
                  M 140 115
                  L 372 115
                  L 460 195
                  L 420 250
                  L 350 230
                  L 350 430
                  L 162 430
                  L 162 230
                  L 92 250
                  L 52 195
                  Z
                "/>
              </clipPath>
            </defs>

            <!-- TESTO clippato: la forma è fatta SOLO dal testo -->
            <foreignObject x="0" y="0" width="512" height="512" clip-path="url(#tshirtInnerClip)">
              <div xmlns="http://www.w3.org/1999/xhtml" class="tshirt-fo">
                <div id="tshirtText" class="tshirt-text"></div>
              </div>
            </foreignObject>

            <!-- IMPORTANTISSIMO:
                 NESSUN PATH DI BORDO QUI.
                 La sagoma NON deve vedersi. -->
          </svg>
        </div>

        <!-- CONTATTI -->
        <div class="contact-wrapper">
          <p class="role">Editor, writer, historian &amp;c.</p>
          <div class="contact-link-wrapper">
            <a class="link" href="mailto:mmarino1@iuav.it">mmarino1@iuav.it</a>
            <span class="sep">|</span>
            <a class="link" href="https://www.instagram.com/appocundriaa/" target="_blank" rel="noreferrer">
              @appocundriaa ↗
            </a>
            <span class="sep">|</span>
            <a class="link" href="#" target="_blank" rel="noreferrer">substack.com ↗</a>
          </div>
        </div>

        <!-- FILTRI -->
        <section class="filters" aria-label="Filtri">
          <div class="filter-stack" id="filterStack">

            <!-- UN SOLO scarabocchio -->
            <svg class="filter-connector" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <path id="scribble" d="" fill="none"></path>
            </svg>

            <div class="filter-group" id="categoryGroup">
              <button class="pill" data-filter="Essay" type="button">Essay</button>
              <button class="pill" data-filter="Speaking" type="button">Speaking</button>
              <button class="pill" data-filter="Editing" type="button">Editing</button>
              <button class="pill is-active" data-filter="Journalism" type="button">Journalism</button>
            </div>

            <div class="filter-group" id="tagGroup">
              <button class="pill is-active" data-filter="Fashion" type="button">Fashion</button>
              <button class="pill" data-filter="Art" type="button">Art</button>
              <button class="pill" data-filter="Culture" type="button">Culture</button>
              <button class="pill" data-filter="Design" type="button">Design</button>
              <button class="pill" data-filter="History" type="button">History</button>
            </div>
          </div>
        </section>

      </div>

      <div></div>
    </div>
  </header>

  <main class="page-content">
    <section class="work-grid" aria-label="Lavori">
      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Behind the Campaign @ Miu Miu with Lengua ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            An Interview with Evan Kinori @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Culture">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Trend Forecasters on Predicting the Future @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>
    </section>

    <footer class="footer">
      <p>© 2026 – Marco Marino</p>
    </footer>
  </main>

  <script>
    // ======== TESTO T-SHIRT: righe controllate (Nessun testo "mancante") ========

    function getBioText(){
      const src = document.getElementById('bioSource');
      return (src?.textContent || '').trim().replace(/\s+/g, ' ');
    }

    function makeMeasure(font){
      const c = document.createElement('canvas');
      const ctx = c.getContext('2d');
      ctx.font = font;
      return (str) => ctx.measureText(str).width;
    }

    const CLIP_POLY = [
      {x:140, y:115},
      {x:372, y:115},
      {x:460, y:195},
      {x:420, y:250},
      {x:350, y:230},
      {x:350, y:430},
      {x:162, y:430},
      {x:162, y:230},
      {x: 92, y:250},
      {x: 52, y:195}
    ];

    const CLIP_MIN_Y = 115;
    const CLIP_MAX_Y = 430;

    function segIntersectX(p1, p2, y){
      const y1 = p1.y, y2 = p2.y;
      const minY = Math.min(y1, y2);
      const maxY = Math.max(y1, y2);

      if (y < minY || y >= maxY) return null; // [min, max)
      if (y1 === y2) return null;

      const t = (y - y1) / (y2 - y1);
      return p1.x + t * (p2.x - p1.x);
    }

    // Se il poligono dà 4 intersezioni (zona maniche concava),
    // prendiamo SEMPRE il "corpo": coppia centrale [1,2].
    function widthAtSvgY(y){
      const xs = [];
      for (let i = 0; i < CLIP_POLY.length; i++){
        const a = CLIP_POLY[i];
        const b = CLIP_POLY[(i + 1) % CLIP_POLY.length];
        const x = segIntersectX(a, b, y);
        if (x !== null) xs.push(x);
      }
      if (xs.length < 2) return 0;
      xs.sort((m,n) => m - n);
      if (xs.length >= 4) return xs[2] - xs[1];
      return xs[1] - xs[0];
    }

    function layoutTshirtText(){
      const fo = document.querySelector('.tshirt-fo');
      const host = document.getElementById('tshirtText');
      if (!fo || !host) return;

      const text = getBioText();
      host.innerHTML = '';
      if (!text) return;

      const W = fo.clientWidth;
      const H = fo.clientHeight;

      // --- QUESTA È LA FIX CHIAVE ---
      // Il clip vive tra y=115..430 in SVG.
      // Quindi dobbiamo "abbassare" il blocco testo fino all'inizio della maglietta.
      const clipTopPx = (CLIP_MIN_Y / 512) * H;
      const clipHPx   = ((CLIP_MAX_Y - CLIP_MIN_Y) / 512) * H;

      // padding interno minimo dentro la maglietta
      const innerTopPad = Math.round(clipHPx * 0.02);
      const innerBotPad = Math.round(clipHPx * 0.02);

      const weight = 600;
      const family = 'KeroinePRO, "General Sans", Arial, sans-serif';
      const lineHeightRatio = 1.10;

      // sicurezza per evitare che lettere tocchino il bordo e vengano clippate
      const SAFE = 0.94;

      function tryFit(fontSize){
        const lineH = fontSize * lineHeightRatio;
        const usableH = Math.max(1, clipHPx - innerTopPad - innerBotPad);
        const maxLines = Math.max(1, Math.floor(usableH / lineH));

        const font = `${weight} ${fontSize}px ${family}`;
        const measure = makeMeasure(font);

        let idx = 0;
        const lines = [];

        for (let i = 0; i < maxLines && idx < text.length; i++){
          // centro riga in "clip space" (0..clipHPx) → poi in SVG y
          const yPxInClip = innerTopPad + i * lineH + lineH * 0.55;
          const t = yPxInClip / clipHPx; // 0..1
          const ySvg = CLIP_MIN_Y + t * (CLIP_MAX_Y - CLIP_MIN_Y);

          const wSvg = widthAtSvgY(ySvg) * SAFE;
          const maxWpx = Math.max(10, (wSvg / 512) * W);

          let chunk = '';
          let lastGood = '';
          let lastGoodIdx = idx;

          while (idx < text.length){
            const next = chunk + text[idx];
            if (measure(next) <= maxWpx){
              chunk = next;
              lastGood = chunk;
              lastGoodIdx = idx + 1;
              idx++;
            } else {
              break;
            }
          }

          if (!lastGood){
            lastGood = text[idx] || '';
            lastGoodIdx = idx + 1;
            idx = lastGoodIdx;
          }

          lines.push({
            text: lastGood.replace(/^\s+/, ''),
            w: Math.round(maxWpx)
          });

          idx = lastGoodIdx;
        }

        return { finished: idx >= text.length, lines };
      }

      const MAX = 44;
      const MIN = 8;
      let best = null;

      for (let s = MAX; s >= MIN; s -= 0.5){
        const res = tryFit(s);
        if (res.finished){
          best = { fontSize: s, ...res };
          break;
        }
      }

      if (!best){
        const res = tryFit(MIN);
        best = { fontSize: MIN, ...res };
      }

      // render
      host.style.fontSize = best.fontSize + 'px';
      host.style.fontWeight = String(weight);
      host.style.lineHeight = String(lineHeightRatio);

      // QUESTO fa sì che la prima riga parta dentro la maglietta (non sopra → non viene tagliata)
      host.style.paddingTop = (clipTopPx + innerTopPad) + 'px';
      host.style.paddingBottom = innerBotPad + 'px';

      for (const line of best.lines){
        const div = document.createElement('div');
        div.className = 'tline';
        div.style.width = line.w + 'px';
        div.textContent = line.text;
        host.appendChild(div);
      }
    }

    // ======== FILTRI (come avevi) ========

    function setupFilters() {
      const state = { category: 'Journalism', tag: 'Fashion' };
      const categoryGroup = document.getElementById('categoryGroup');
      const tagGroup = document.getElementById('tagGroup');

      const normTags = (raw) => (raw || '').split(',').map(s => s.trim()).filter(Boolean);

      const setActive = (groupEl, value) => {
        groupEl.querySelectorAll('.pill').forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.filter === value);
        });
      };

      const updateList = () => {
        document.querySelectorAll('.work-row').forEach((row) => {
          const c = row.getAttribute('data-category') || '';
          const tags = normTags(row.getAttribute('data-tags'));
          row.style.display = (c === state.category && tags.includes(state.tag)) ? '' : 'none';
        });
      };

      const bind = (groupEl, key) => {
        groupEl.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-filter]');
          if (!btn) return;
          state[key] = btn.dataset.filter;
          setActive(groupEl, state[key]);
          updateList();
          drawScribble(state.category + '|' + state.tag);
        });
      };

      bind(categoryGroup, 'category');
      bind(tagGroup, 'tag');
      setActive(categoryGroup, state.category);
      setActive(tagGroup, state.tag);
      updateList();
      drawScribble(state.category + '|' + state.tag);
    }

    // ======== scarabocchio singolo (come avevi) ========

    function seededRand(seedStr) {
      let h = 2166136261;
      for (let i = 0; i < seedStr.length; i++) h = (h ^ seedStr.charCodeAt(i)) * 16777619;
      let x = h >>> 0;
      return () => {
        x ^= x << 13; x >>>= 0;
        x ^= x >> 17; x >>>= 0;
        x ^= x << 5;  x >>>= 0;
        return (x >>> 0) / 4294967296;
      };
    }

    function drawScribble(seedKey) {
      const stackEl = document.getElementById('filterStack');
      const categoryGroup = document.getElementById('categoryGroup');
      const tagGroup = document.getElementById('tagGroup');
      const s = document.getElementById('scribble');
      if (!stackEl || !categoryGroup || !tagGroup || !s) return;

      const a = categoryGroup.querySelector('.pill.is-active');
      const b = tagGroup.querySelector('.pill.is-active');
      if (!a || !b) { s.setAttribute('d',''); return; }

      const fr = stackEl.getBoundingClientRect();
      const ra = a.getBoundingClientRect();
      const rb = b.getBoundingClientRect();

      const x1 = ((ra.left + ra.width/2) - fr.left) / fr.width * 100;
      const y1 = ((ra.top + ra.height/2) - fr.top) / fr.height * 100;
      const x2 = ((rb.left + rb.width/2) - fr.left) / fr.width * 100;
      const y2 = ((rb.top + rb.height/2) - fr.top) / fr.height * 100;

      const r = seededRand(seedKey);

      const cx1 = x1 + (x2 - x1) * 0.25;
      const cy1 = y1 - 10 + (r()-0.5)*6;
      const cx2 = x1 + (x2 - x1) * 0.75;
      const cy2 = y2 + 10 + (r()-0.5)*6;

      function bezier(t){
        const mt = 1 - t;
        const x = mt*mt*mt*x1 + 3*mt*mt*t*cx1 + 3*mt*t*t*cx2 + t*t*t*x2;
        const y = mt*mt*mt*y1 + 3*mt*mt*t*cy1 + 3*mt*t*t*cy2 + t*t*t*y2;
        return {x,y};
      }

      const pts = [];
      const steps = 22;
      for (let i = 0; i <= steps; i++) {
        const t = i / steps;
        const p = bezier(t);
        const amp = Math.sin(Math.PI * t) * 2.2;
        pts.push({
          x: p.x + (r()-0.5)*amp*2.4,
          y: p.y + (r()-0.5)*amp*3.0
        });
      }

      let d = `M ${pts[0].x.toFixed(2)} ${pts[0].y.toFixed(2)}`;
      for (let i = 1; i < pts.length - 1; i++) {
        const cpx = pts[i].x, cpy = pts[i].y;
        const nx = (pts[i].x + pts[i+1].x) / 2;
        const ny = (pts[i].y + pts[i+1].y) / 2;
        d += ` Q ${cpx.toFixed(2)} ${cpy.toFixed(2)} ${nx.toFixed(2)} ${ny.toFixed(2)}`;
      }
      d += ` L ${pts[pts.length-1].x.toFixed(2)} ${pts[pts.length-1].y.toFixed(2)}`;
      s.setAttribute('d', d);
    }

    (function init(){
      setupFilters();

      const run = () => layoutTshirtText();
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(run);
      } else {
        run();
      }

      window.addEventListener('resize', () => {
        layoutTshirtText();
        const c = document.querySelector('#categoryGroup .pill.is-active')?.dataset.filter || '';
        const t = document.querySelector('#tagGroup .pill.is-active')?.dataset.filter || '';
        drawScribble(c + '|' + t);
      });
    })();
  </script>

</body>
</html>
