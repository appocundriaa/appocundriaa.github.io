<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marco Marino</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <header class="header">
    <div class="header-grid">
      <div></div>

      <div class="header-content">

        <!-- TESTO SORGENTE: NON TOCCARE -->
        <p id="bioText" class="bio-text">
È un Sironi! Tra i più famosi. Pubblicato su tutti i cataloghi. È del periodo pessimista! Il più raro. Questo se t'o attacchi in ufficio c'hai uno scatto da così a così! Te lo metti in casa, fai un figurone! Io ce l'ho avuto in salotto per vent'anni, tu non sai quanto m'ha aiutato a me, le serate che m'ha risolto... perché è anche un argomento di conversazione, sai? C'è pure chi dice: se c'ha 'e zinne viola, de che colore c'avrà er culo?
        </p>

        <!-- WRAP: contiene SVG mask + testo -->
        <div class="tshirt-wrap" aria-label="Testo dentro una maglietta">

          <!-- SVG che definisce la silhouette (clip-path) -->
          <svg class="tshirt-clip" viewBox="0 0 512 512" aria-hidden="true">
            <defs>
              <!-- silhouette t-shirt (semplice ma simile alla tua icona) -->
              <clipPath id="clipTshirt" clipPathUnits="objectBoundingBox">
                <!-- path in objectBoundingBox: normalizziamo via JS -->
              </clipPath>
            </defs>
          </svg>

          <!-- Questo layer clipperà il testo -->
          <div class="tshirt-shape" id="tshirtShape">
            <div class="tshirt-text">
              <!-- duplico il testo da #bioText via JS per non avere doppioni nel DOM visibile -->
              <div id="tshirtTextTarget"></div>
            </div>
          </div>
        </div>

        <!-- CONTATTI -->
        <div class="contact-wrapper">
          <p class="role">Editor, writer, historian &amp;c.</p>
          <div class="contact-link-wrapper">
            <a class="link" href="mailto:mmarino1@iuav.it">mmarino1@iuav.it</a>
            <span class="sep">|</span>
            <a class="link" href="https://www.instagram.com/appocundriaa/" target="_blank" rel="noreferrer">
              @appocundriaa ↗
            </a>
            <span class="sep">|</span>
            <a class="link" href="#" target="_blank" rel="noreferrer">substack.com ↗</a>
          </div>
        </div>

        <!-- FILTRI -->
        <section class="filters" aria-label="Filtri">
          <div class="filter-stack" id="filterStack">
            <svg class="filter-connector" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <path id="filterConnectorPath" d="" fill="none"></path>
            </svg>

            <div class="filter-group" id="categoryGroup">
              <button class="pill" data-filter="Essay" type="button">Essay</button>
              <button class="pill" data-filter="Speaking" type="button">Speaking</button>
              <button class="pill" data-filter="Editing" type="button">Editing</button>
              <button class="pill is-active" data-filter="Journalism" type="button">Journalism</button>
            </div>

            <div class="filter-group" id="tagGroup">
              <button class="pill is-active" data-filter="Fashion" type="button">Fashion</button>
              <button class="pill" data-filter="Art" type="button">Art</button>
              <button class="pill" data-filter="Culture" type="button">Culture</button>
              <button class="pill" data-filter="Design" type="button">Design</button>
              <button class="pill" data-filter="History" type="button">History</button>
            </div>
          </div>
        </section>

      </div>

      <div></div>
    </div>
  </header>

  <main class="page-content">
    <section class="work-grid" aria-label="Lavori">
      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Behind the Campaign @ Miu Miu with Lengua ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            An Interview with Evan Kinori @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Culture">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Trend Forecasters on Predicting the Future @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>
    </section>

    <footer class="footer">
      <p>© 2026 – Marco Marino</p>
    </footer>
  </main>

  <script>
    // -------------------------
    // 1) Duplica testo dentro shape (così #bioText può restare sr-only)
    // -------------------------
    (function mountText() {
      const src = document.getElementById('bioText');
      const target = document.getElementById('tshirtTextTarget');
      if (!src || !target) return;
      target.textContent = src.textContent.trim();
      // nascondi la sorgente (ma resta nel DOM per edit facile)
      src.classList.add('sr-only');
    })();

    // -------------------------
    // 2) Crea clipPath in objectBoundingBox (compatibilità CSS clip-path:url)
    //    Trucchetto: usiamo un path in viewBox 512 e lo normalizziamo in 0..1
    // -------------------------
    (function buildClipPath() {
      const svg = document.querySelector('.tshirt-clip');
      const clip = svg?.querySelector('#clipTshirt');
      if (!svg || !clip) return;

      // path t-shirt in coordinate 0..512 (simile icona)
      const d512 = `
        M 140 110
        L 90 150
        L 120 210
        L 170 190
        L 170 410
        L 342 410
        L 342 190
        L 392 210
        L 422 150
        L 372 110
        C 342 135 310 150 256 150
        C 202 150 170 135 140 110
        Z
        M 200 110
        C 212 140 228 150 256 150
        C 284 150 300 140 312 110
        C 296 92 280 82 256 82
        C 232 82 216 92 200 110
        Z
      `;

      // normalizza d da 0..512 a 0..1: moltiplicatore 1/512
      // SVG path non supporta scale nel d, quindi usiamo <path transform="scale(...)"> dentro clipPath in userSpaceOnUse?
      // In clipPathUnits="objectBoundingBox" possiamo invece mettere un <path> con transform="scale(1/512)".
      clip.setAttribute('clipPathUnits', 'objectBoundingBox');
      clip.innerHTML = `<path d="${d512}" transform="scale(${1/512})" />`;

      // applica clip al div via CSS (url(#clipTshirt) deve puntare al documento)
      // workaround: usa clip-path: path() come fallback se url non prende
    })();

    // -------------------------
    // 3) Auto-fit font-size per far stare il testo dentro la maglietta
    // -------------------------
    (function fitText() {
      const shape = document.getElementById('tshirtShape');
      const textEl = document.querySelector('.tshirt-text');
      if (!shape || !textEl) return;

      const set = (px) => textEl.style.fontSize = px + 'px';

      // base: piccolo
      let size = 13;
      set(size);

      // riduci finché non entra (senza overflow)
      for (let i = 0; i < 30; i++) {
        if (textEl.scrollHeight <= shape.clientHeight && textEl.scrollWidth <= shape.clientWidth) break;
        size -= 0.5;
        set(size);
        if (size <= 9) break;
      }
    })();

    // -------------------------
    // 4) Filtri + connector
    // -------------------------
    (function filtersAndConnector() {
      const state = { category: 'Journalism', tag: 'Fashion' };
      const categoryGroup = document.getElementById('categoryGroup');
      const tagGroup = document.getElementById('tagGroup');
      const path = document.getElementById('filterConnectorPath');
      const stackEl = document.getElementById('filterStack');

      const normTags = (raw) => (raw || '').split(',').map(s => s.trim()).filter(Boolean);

      const setActive = (groupEl, value) => {
        groupEl.querySelectorAll('.pill').forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.filter === value);
        });
      };

      const updateList = () => {
        document.querySelectorAll('.work-row').forEach((row) => {
          const c = row.getAttribute('data-category') || '';
          const tags = normTags(row.getAttribute('data-tags'));
          row.style.display = (c === state.category && tags.includes(state.tag)) ? '' : 'none';
        });
      };

      const onClick = (groupEl, key) => {
        groupEl.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-filter]');
          if (!btn) return;
          state[key] = btn.dataset.filter;
          setActive(groupEl, state[key]);
          updateList();
          drawConnector();
        });
      };

      function centerOf(el) {
        const r = el.getBoundingClientRect();
        return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
      }

      function drawConnector() {
        const a = categoryGroup.querySelector('.pill.is-active');
        const b = tagGroup.querySelector('.pill.is-active');
        if (!a || !b) { path.setAttribute('d', ''); return; }

        const fr = stackEl.getBoundingClientRect();
        const p1 = centerOf(a);
        const p2 = centerOf(b);

        const x1 = ((p1.x - fr.left) / fr.width) * 100;
        const y1 = ((p1.y - fr.top) / fr.height) * 100;
        const x2 = ((p2.x - fr.left) / fr.width) * 100;
        const y2 = ((p2.y - fr.top) / fr.height) * 100;

        const midY = (y1 + y2) / 2;
        const midX = (x1 + x2) / 2;

        const d = `
          M ${x1} ${y1}
          C ${x1 + 8} ${midY - 12},
            ${midX - 14} ${midY + 12},
            ${midX} ${midY}
          C ${midX + 14} ${midY - 12},
            ${x2 - 8} ${midY + 12},
            ${x2} ${y2}
        `;
        path.setAttribute('d', d);
      }

      onClick(categoryGroup, 'category');
      onClick(tagGroup, 'tag');

      setActive(categoryGroup, state.category);
      setActive(tagGroup, state.tag);
      updateList();
      drawConnector();

      window.addEventListener('resize', drawConnector);
    })();
  </script>

</body>
</html>
