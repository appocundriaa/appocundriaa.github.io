<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marco Marino</title>

  <!-- General Sans -->
  <link href="https://api.fontshare.com/v2/css?f[]=general-sans@400,500,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>

<body class="default">

  <header class="header">
    <div class="header-grid">
      <div class="spacer"></div>

      <div class="header-content">

        <!-- Testo sorgente (non visibile) -->
        <p id="bioSource" class="sr-only">
È un Sironi! Tra i più famosi. Pubblicato su tutti i cataloghi. È del periodo pessimista! Il più raro. Questo se t'o attacchi in ufficio c'hai uno scatto da così a così! Te lo metti in casa, fai un figurone! Io ce l'ho avuto in salotto per vent'anni, tu non sai quanto m'ha aiutato a me, le serate che m'ha risolto... perché è anche un argomento di conversazione, sai? C'è pure chi dice: se c'ha 'e zinne viola, de che colore c'avrà er culo?
        </p>

        <!-- Cerchio -->
        <div class="bio-circle" aria-label="Bio">
          <div id="bioCircleLines" class="bio-circle__lines"></div>
        </div>

        <!-- Contatti -->
        <div class="contact-wrapper">
          <p class="role">Editor, writer, historian &amp;c.</p>
          <div class="contact-link-wrapper">
            <a class="link" href="mailto:mmarino1@iuav.it">mmarino1@iuav.it</a>
            <span class="sep">|</span>
            <a class="link" href="https://www.instagram.com/appocundriaa/" target="_blank" rel="noreferrer">
              @appocundriaa ↗
            </a>
            <span class="sep">|</span>
            <a class="link" href="#" target="_blank" rel="noreferrer">substack.com ↗</a>
          </div>
        </div>

        <!-- Filtri -->
        <section class="filters" id="filters" aria-label="Filtri">
          <div class="filter-stack" id="filterStack">

            <svg class="filter-connector" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <path id="filterConnectorPath" d="" fill="none"></path>
            </svg>

            <div class="filter-group" id="categoryGroup">
              <button class="pill" data-filter="Essay" type="button">Essay</button>
              <button class="pill" data-filter="Speaking" type="button">Speaking</button>
              <button class="pill" data-filter="Editing" type="button">Editing</button>
              <button class="pill is-active" data-filter="Journalism" type="button">Journalism</button>
            </div>

            <div class="filter-group" id="tagGroup">
              <button class="pill is-active" data-filter="Fashion" type="button">Fashion</button>
              <button class="pill" data-filter="Art" type="button">Art</button>
              <button class="pill" data-filter="Culture" type="button">Culture</button>
              <button class="pill" data-filter="Design" type="button">Design</button>
              <button class="pill" data-filter="History" type="button">History</button>
            </div>

          </div>
        </section>

      </div>

      <div class="spacer"></div>
    </div>
  </header>

  <main class="page-content">
    <section class="work-grid" aria-label="Lavori">
      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Behind the Campaign @ Miu Miu with Lengua ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            An Interview with Evan Kinori @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Culture">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Trend Forecasters on Predicting the Future @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>
    </section>

    <footer class="footer">
      <p>© 2026 – Marco Marino</p>
    </footer>

    <script>
      // -----------------------------
      // CERCHIO: auto-fit “vero”
      // Obiettivo: ultimo testo vicino al fondo del cerchio (niente vuoto gigante)
      // -----------------------------
      (function renderCircle() {
        const sourceEl = document.getElementById('bioSource');
        const outEl = document.getElementById('bioCircleLines');
        if (!sourceEl || !outEl) return;

        const text = (sourceEl.textContent || '').trim().replace(/\s+/g, ' ');
        const words = text.split(' ').filter(Boolean);
        if (!words.length) return;

        const ctx = document.createElement('canvas').getContext('2d');

        function maxWidthAtY(r, y) {
          const half = Math.sqrt(Math.max(0, (r * r) - (y * y)));
          return Math.max(0, 2 * half);
        }

        function layoutOnce(diameter, fs) {
          const lh = fs + 2.0;
          const padding = 10;
          const r = (diameter / 2) - padding;
          const linesCount = Math.max(22, Math.floor((2 * r) / lh));
          const yStart = -r + (lh / 2);

          ctx.font = `600 ${fs}px "General Sans", Arial, sans-serif`;

          const lines = [];
          let idx = 0;
          let lastUsed = -1;

          for (let i = 0; i < linesCount; i++) {
            const y = yStart + i * lh;
            const maxW = maxWidthAtY(r, y);

            // poli: lascia vuoto per arrotondare
            if (maxW < fs * 2.6) {
              lines.push({ w: maxW, t: "", fs, lh });
              continue;
            }

            let line = "";
            while (idx < words.length) {
              const next = line ? (line + " " + words[idx]) : words[idx];
              const w = ctx.measureText(next).width;
              if (w <= maxW) { line = next; idx++; }
              else break;
            }

            // se una parola non entra mai, forzala (meglio che troncare)
            if (!line && idx < words.length) line = words[idx++];

            if (line) lastUsed = i;
            lines.push({ w: maxW, t: line, fs, lh });

            if (idx >= words.length) break;
          }

          const overflow = idx < words.length;
          return { lines, overflow, lastUsed, linesCount, fs, lh };
        }

        function renderLines(result, diameter) {
          outEl.innerHTML = "";
          outEl.closest(".bio-circle").style.setProperty("--bio-d", `${diameter}px`);

          // IMPORTANT: rendiamo l’altezza del cerchio “vera” (diametro)
          // così non ti crea spazi strani/scroll.
          outEl.style.setProperty("--bio-fs", `${result.fs}px`);
          outEl.style.setProperty("--bio-lh", `${result.lh}px`);

          // disegniamo TUTTE le righe fino a linesCount,
          // e quelle dopo lastUsed diventano vuote per chiudere il cerchio.
          const linesCountTarget = Math.max(result.linesCount, result.lines.length);

          for (let i = 0; i < linesCountTarget; i++) {
            const item = result.lines[i] || result.lines[result.lines.length - 1];
            const div = document.createElement("div");
            div.className = "bio-line";
            div.style.width = `${item.w}px`;
            div.innerHTML = (i <= result.lastUsed && item.t) ? item.t : "&nbsp;";
            outEl.appendChild(div);
          }
        }

        // diametro più simile reference (meno “vuoto” sotto)
        let diameter = Math.min(420, Math.floor(window.innerWidth * 0.86));

        // Ricerca fs: vogliamo:
        // - non overflow
        // - lastUsed vicino al fondo (linesCount-2)
        let best = null;
        for (let fs = 11; fs <= 16; fs += 0.25) {
          const r = layoutOnce(diameter, fs);
          if (r.overflow) continue;

          const target = r.linesCount - 2;
          const score = Math.abs((r.lastUsed >= 0 ? r.lastUsed : 0) - target);

          if (!best || score < best.score) best = { ...r, score, fs };
        }

        // se non troviamo nulla (rarissimo), riduci diametro e riprova
        if (!best) {
          diameter = Math.max(340, diameter - 60);
          for (let fs = 11; fs <= 16; fs += 0.25) {
            const r = layoutOnce(diameter, fs);
            if (r.overflow) continue;
            const target = r.linesCount - 2;
            const score = Math.abs((r.lastUsed >= 0 ? r.lastUsed : 0) - target);
            if (!best || score < best.score) best = { ...r, score, fs };
          }
        }

        if (!best) {
          // fallback estremo: render semplice
          best = layoutOnce(diameter, 12);
        }

        renderLines(best, diameter);
      })();

      // -----------------------------
      // FILTRI + freccia “più hand-drawn”
      // -----------------------------
      (function filtersAndConnector() {
        const state = { category: 'Journalism', tag: 'Fashion' };
        const categoryGroup = document.getElementById('categoryGroup');
        const tagGroup = document.getElementById('tagGroup');

        const normTags = (raw) => (raw || '').split(',').map(s => s.trim()).filter(Boolean);

        const setActive = (groupEl, value) => {
          groupEl.querySelectorAll('.pill').forEach(btn => {
            btn.classList.toggle('is-active', btn.dataset.filter === value);
          });
        };

        const updateList = () => {
          document.querySelectorAll('.work-row').forEach((row) => {
            const c = row.getAttribute('data-category') || '';
            const tags = normTags(row.getAttribute('data-tags'));
            row.style.display = (c === state.category && tags.includes(state.tag)) ? '' : 'none';
          });
        };

        const onClick = (groupEl, key) => {
          groupEl.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-filter]');
            if (!btn) return;
            state[key] = btn.dataset.filter;
            setActive(groupEl, state[key]);
            updateList();
            drawConnector();
          });
        };

        onClick(categoryGroup, 'category');
        onClick(tagGroup, 'tag');
        setActive(categoryGroup, state.category);
        setActive(tagGroup, state.tag);
        updateList();

        const stackEl = document.getElementById('filterStack');
        const path = document.getElementById('filterConnectorPath');

        function centerOf(el) {
          const r = el.getBoundingClientRect();
          return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
        }

        function drawConnector() {
          const a = categoryGroup.querySelector('.pill.is-active');
          const b = tagGroup.querySelector('.pill.is-active');
          if (!a || !b) { path.setAttribute('d', ''); return; }

          const fr = stackEl.getBoundingClientRect();
          const p1 = centerOf(a);
          const p2 = centerOf(b);

          const x1 = ((p1.x - fr.left) / fr.width) * 100;
          const y1 = ((p1.y - fr.top) / fr.height) * 100;
          const x2 = ((p2.x - fr.left) / fr.width) * 100;
          const y2 = ((p2.y - fr.top) / fr.height) * 100;

          // più simile reference: “S” stretta con pancia + piccola gobba
          const midX = (x1 + x2) / 2;
          const midY = (y1 + y2) / 2;
          const bump = 10;

          const d = `
            M ${x1} ${y1}
            C ${x1 + 6} ${midY - bump},
              ${midX - 10} ${midY + bump},
              ${midX} ${midY}
            C ${midX + 10} ${midY - bump},
              ${x2 - 6} ${midY + bump},
              ${x2} ${y2}
          `;
          path.setAttribute('d', d);
        }

        window.addEventListener('resize', drawConnector);
        drawConnector();
      })();
    </script>

  </main>
</body>
</html>
