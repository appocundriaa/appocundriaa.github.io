<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marco Marino</title>

  <!-- General Sans -->
  <link href="https://api.fontshare.com/v2/css?f[]=general-sans@400,500,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>

<body class="default">

  <header class="header">
    <div class="header-grid">
      <div class="spacer"></div>

      <div class="header-content">

        <!-- SORGENTE TESTO (non visibile) -->
        <p id="bioSource" class="sr-only">
È un Sironi! Tra i più famosi. Pubblicato su tutti i cataloghi. È del periodo pessimista! Il più raro. Questo se t'o attacchi in ufficio c'hai uno scatto da così a così! Te lo metti in casa, fai un figurone! Io ce l'ho avuto in salotto per vent'anni, tu non sai quanto m'ha aiutato a me, le serate che m'ha risolto... perché è anche un argomento di conversazione, sai? C'è pure chi dice: se c'ha 'e zinne viola, de che colore c'avrà er culo?
        </p>

        <!-- CERCHIO (righe generate via JS) -->
        <div class="bio-circle" aria-label="Bio">
          <div id="bioCircleLines" class="bio-circle__lines"></div>
        </div>

        <!-- CONTATTI -->
        <div class="contact-wrapper">
          <p class="role">Editor, writer, historian &amp;c.</p>
          <div class="contact-link-wrapper">
            <a class="link" href="mailto:mmarino1@iuav.it">mmarino1@iuav.it</a>
            <span class="sep">|</span>
            <a class="link" href="https://www.instagram.com/appocundriaa/" target="_blank" rel="noreferrer">
              @appocundriaa ↗
            </a>
            <span class="sep">|</span>
            <a class="link" href="#" target="_blank" rel="noreferrer">substack.com ↗</a>
          </div>
        </div>

        <!-- FILTRI + connettore -->
        <section class="filters" id="filters" aria-label="Filtri">
          <div class="filter-stack" id="filterStack">

            <svg id="filterConnector" class="filter-connector" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <path id="filterConnectorPath" d="" fill="none"></path>
            </svg>

            <div class="filter-group" id="categoryGroup">
              <button class="pill" data-filter="Essay" type="button">Essay</button>
              <button class="pill" data-filter="Speaking" type="button">Speaking</button>
              <button class="pill" data-filter="Editing" type="button">Editing</button>
              <button class="pill is-active" data-filter="Journalism" type="button">Journalism</button>
            </div>

            <div class="filter-group" id="tagGroup">
              <button class="pill is-active" data-filter="Fashion" type="button">Fashion</button>
              <button class="pill" data-filter="Art" type="button">Art</button>
              <button class="pill" data-filter="Culture" type="button">Culture</button>
              <button class="pill" data-filter="Design" type="button">Design</button>
              <button class="pill" data-filter="History" type="button">History</button>
            </div>

          </div>
        </section>

      </div>
      <div class="spacer"></div>
    </div>
  </header>

  <main class="page-content">
    <section class="work-grid" aria-label="Lavori">

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Behind the Campaign @ Miu Miu with Lengua ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            An Interview with Evan Kinori @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Culture">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Trend Forecasters on Predicting the Future @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

    </section>

    <footer class="footer">
      <p>© 2026 – Marco Marino</p>
    </footer>

    <script>
      // ------------------------------------------------------------
      // 1) CERCHIO MIGLIORATO: sempre completo + più “rotondo”
      // ------------------------------------------------------------
      (function renderCircleBetter() {
        const sourceEl = document.getElementById('bioSource');
        const outEl = document.getElementById('bioCircleLines');
        if (!sourceEl || !outEl) return;

        const text = (sourceEl.textContent || '').trim().replace(/\s+/g, ' ');
        const words = text.split(' ').filter(Boolean);
        if (!words.length) return;

        const ctx = document.createElement('canvas').getContext('2d');

        // Parametri target (simili reference)
        let diameter = Math.min(460, Math.floor(window.innerWidth * 0.86));
        let fontSize = 13.5;
        let lineHeight = 15.5;

        const padding = 10;
        const minFont = 11;
        const maxAttempts = 40;

        function maxWidthAtY(r, y) {
          const half = Math.sqrt(Math.max(0, (r * r) - (y * y)));
          return Math.max(0, 2 * half);
        }

        function renderOnce(d, fs, lh) {
          const r = (d / 2) - padding;

          // più righe = bordo più “liscio”
          const linesCount = Math.max(22, Math.floor((2 * r) / lh));
          const yStart = -r + (lh / 2);

          ctx.font = `600 ${fs}px "General Sans", Arial, sans-serif`;

          outEl.innerHTML = '';
          let idx = 0;

          for (let i = 0; i < linesCount; i++) {
            const y = yStart + i * lh;
            const maxW = maxWidthAtY(r, y);

            // Poli: righe molto strette -> lascia vuoto per non creare “punta”
            if (maxW < fs * 2.4) {
              const div = document.createElement('div');
              div.className = 'bio-line';
              div.style.width = `${maxW}px`;
              div.style.setProperty('--bio-fs', `${fs}px`);
              div.style.setProperty('--bio-lh', `${lh}px`);
              div.innerHTML = '&nbsp;';
              outEl.appendChild(div);
              continue;
            }

            let line = '';
            while (idx < words.length) {
              const next = line ? (line + ' ' + words[idx]) : words[idx];
              const w = ctx.measureText(next).width;
              if (w <= maxW) {
                line = next;
                idx++;
              } else {
                break;
              }
            }

            // parola lunghissima: forziamo comunque (meglio che troncare tutto)
            if (!line && idx < words.length) {
              line = words[idx++];
            }

            const div = document.createElement('div');
            div.className = 'bio-line';
            div.style.width = `${maxW}px`;
            div.style.setProperty('--bio-fs', `${fs}px`);
            div.style.setProperty('--bio-lh', `${lh}px`);
            div.textContent = line;
            outEl.appendChild(div);

            if (idx >= words.length) {
              // riempi il resto con righe vuote per chiudere il cerchio “bene”
              for (let j = i + 1; j < linesCount; j++) {
                const y2 = yStart + j * lh;
                const maxW2 = maxWidthAtY(r, y2);
                const filler = document.createElement('div');
                filler.className = 'bio-line';
                filler.style.width = `${maxW2}px`;
                filler.style.setProperty('--bio-fs', `${fs}px`);
                filler.style.setProperty('--bio-lh', `${lh}px`);
                filler.innerHTML = '&nbsp;';
                outEl.appendChild(filler);
              }
              break;
            }
          }

          return idx >= words.length;
        }

        // Applica diametro al container
        const container = outEl.closest('.bio-circle');
        container.style.setProperty('--bio-d', `${diameter}px`);

        // Auto-fit: se non entra tutto, riduci fs/lh finché entra
        let ok = false;
        for (let attempt = 0; attempt < maxAttempts; attempt++) {
          ok = renderOnce(diameter, fontSize, lineHeight);
          if (ok) break;

          fontSize = Math.max(minFont, fontSize - 0.35);
          lineHeight = Math.max(fontSize + 1.2, lineHeight - 0.35);
        }

        // fallback: se ancora no, aumenta un po’ il diametro e riprova
        if (!ok) {
          diameter = Math.min(560, diameter + 80);
          container.style.setProperty('--bio-d', `${diameter}px`);
          renderOnce(diameter, fontSize, lineHeight);
        }
      })();

      // ------------------------------------------------------------
      // 2) FILTRI + “freccia” più simile reference
      // ------------------------------------------------------------
      (function filtersAndConnector() {
        const state = { category: 'Journalism', tag: 'Fashion' };

        const categoryGroup = document.getElementById('categoryGroup');
        const tagGroup = document.getElementById('tagGroup');

        const normTags = (raw) => (raw || '').split(',').map(s => s.trim()).filter(Boolean);

        const setActive = (groupEl, value) => {
          groupEl.querySelectorAll('.pill').forEach(btn => {
            btn.classList.toggle('is-active', btn.dataset.filter === value);
          });
        };

        const updateList = () => {
          document.querySelectorAll('.work-row').forEach((row) => {
            const c = row.getAttribute('data-category') || '';
            const tags = normTags(row.getAttribute('data-tags'));
            row.style.display = (c === state.category && tags.includes(state.tag)) ? '' : 'none';
          });
        };

        const onClick = (groupEl, key) => {
          groupEl.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-filter]');
            if (!btn) return;
            state[key] = btn.dataset.filter;
            setActive(groupEl, state[key]);
            updateList();
            drawConnector();
          });
        };

        onClick(categoryGroup, 'category');
        onClick(tagGroup, 'tag');

        setActive(categoryGroup, state.category);
        setActive(tagGroup, state.tag);
        updateList();

        // connector
        const stackEl = document.getElementById('filterStack');
        const path = document.getElementById('filterConnectorPath');

        function centerOf(el) {
          const r = el.getBoundingClientRect();
          return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
        }

        function drawConnector() {
          const a = categoryGroup.querySelector('.pill.is-active');
          const b = tagGroup.querySelector('.pill.is-active');
          if (!a || !b) { path.setAttribute('d', ''); return; }

          const fr = stackEl.getBoundingClientRect();
          const p1 = centerOf(a);
          const p2 = centerOf(b);

          const x1 = ((p1.x - fr.left) / fr.width) * 100;
          const y1 = ((p1.y - fr.top) / fr.height) * 100;
          const x2 = ((p2.x - fr.left) / fr.width) * 100;
          const y2 = ((p2.y - fr.top) / fr.height) * 100;

          // “scarabocchio” a S (molto simile reference)
          const midY = (y1 + y2) / 2;
          const bump = 8;

          const c1x = x1 + 10;
          const c1y = midY - bump;

          const c2x = x1 + 18;
          const c2y = midY + bump;

          const c3x = x2 - 18;
          const c3y = midY - bump;

          const c4x = x2 - 10;
          const c4y = midY + bump;

          const d = `
            M ${x1} ${y1}
            C ${c1x} ${c1y}, ${c2x} ${c2y}, ${(x1+x2)/2} ${midY}
            C ${c3x} ${c3y}, ${c4x} ${c4y}, ${x2} ${y2}
          `;
          path.setAttribute('d', d);
        }

        window.addEventListener('resize', drawConnector);
        drawConnector();
      })();
    </script>

  </main>
</body>
</html>
