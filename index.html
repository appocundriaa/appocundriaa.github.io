<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marco Marino</title>

  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <header class="header">
    <div class="header-grid">
      <div></div>

      <div class="header-content">

        <!-- Testo sorgente (NON modificato) -->
        <p id="bioSource" class="sr-only">
È un Sironi! Tra i più famosi. Pubblicato su tutti i cataloghi. È del periodo pessimista! Il più raro. Questo se t'o attacchi in ufficio c'hai uno scatto da così a così! Te lo metti in casa, fai un figurone! Io ce l'ho avuto in salotto per vent'anni, tu non sai quanto m'ha aiutato a me, le serate che m'ha risolto... perché è anche un argomento di conversazione, sai? C'è pure chi dice: se c'ha 'e zinne viola, de che colore c'avrà er culo?
        </p>

        <!-- SHAPE: T-SHIRT -->
        <div class="shape-wrap" aria-label="Bio a forma di maglietta">
          <div id="shapeLines" class="shape-lines"></div>
        </div>

        <!-- CONTATTI -->
        <div class="contact-wrapper">
          <p class="role">Editor, writer, historian &amp;c.</p>
          <div class="contact-link-wrapper">
            <a class="link" href="mailto:mmarino1@iuav.it">mmarino1@iuav.it</a>
            <span class="sep">|</span>
            <a class="link" href="https://www.instagram.com/appocundriaa/" target="_blank" rel="noreferrer">
              @appocundriaa ↗
            </a>
            <span class="sep">|</span>
            <a class="link" href="#" target="_blank" rel="noreferrer">substack.com ↗</a>
          </div>
        </div>

        <!-- FILTRI (restano uguali, freccia semplice per ora) -->
        <section class="filters" aria-label="Filtri">
          <div class="filter-stack" id="filterStack">
            <svg class="filter-connector" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
              <path id="filterConnectorPath" d="" fill="none"></path>
            </svg>

            <div class="filter-group" id="categoryGroup">
              <button class="pill" data-filter="Essay" type="button">Essay</button>
              <button class="pill" data-filter="Speaking" type="button">Speaking</button>
              <button class="pill" data-filter="Editing" type="button">Editing</button>
              <button class="pill is-active" data-filter="Journalism" type="button">Journalism</button>
            </div>

            <div class="filter-group" id="tagGroup">
              <button class="pill is-active" data-filter="Fashion" type="button">Fashion</button>
              <button class="pill" data-filter="Art" type="button">Art</button>
              <button class="pill" data-filter="Culture" type="button">Culture</button>
              <button class="pill" data-filter="Design" type="button">Design</button>
              <button class="pill" data-filter="History" type="button">History</button>
            </div>
          </div>
        </section>

      </div>

      <div></div>
    </div>
  </header>

  <main class="page-content">
    <section class="work-grid" aria-label="Lavori">
      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Behind the Campaign @ Miu Miu with Lengua ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Design">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            An Interview with Evan Kinori @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>

      <article class="work-row" data-category="Journalism" data-tags="Fashion,Culture">
        <div class="work-year">2025</div>
        <div class="work-title">
          <a class="work-link" href="#" target="_blank" rel="noreferrer">
            Trend Forecasters on Predicting the Future @ 1 Granary ↗
          </a>
        </div>
        <div class="work-spacer"></div>
      </article>
    </section>

    <footer class="footer">
      <p>© 2026 – Marco Marino</p>
    </footer>
  </main>

  <script>
    // ------------------------------------------------------------
    // SHAPE: T-SHIRT (profilo controllato) + word-spacing per “riempire”
    // ------------------------------------------------------------
    (function renderTshirt() {
      const sourceEl = document.getElementById('bioSource');
      const outEl = document.getElementById('shapeLines');
      const wrap = document.querySelector('.shape-wrap');
      if (!sourceEl || !outEl || !wrap) return;

      const text = (sourceEl.textContent || '').trim().replace(/\s+/g, ' ');
      const words = text.split(' ').filter(Boolean);
      if (!words.length) return;

      const ctx = document.createElement('canvas').getContext('2d');

      // dimensioni shape
      const W = Math.min(520, Math.floor(window.innerWidth * 0.86));
      const H = Math.round(W * 0.90);          // maglietta un po’ più bassa che larga
      wrap.style.setProperty('--shape-w', `${W}px`);
      wrap.style.setProperty('--shape-h', `${H}px`);

      // font tuning (di base piccolo)
      let fs = 11.25;                          // prova: 10.5–12
      let lh = 13.2;                           // line-height compatto

      function fontStr(fs){ return `600 ${fs}px "KeroinePRO", "General Sans", Arial, sans-serif`; }
      function measure(str, fs){
        ctx.font = fontStr(fs);
        return ctx.measureText(str).width;
      }

      // Profilo maglietta: restituisce larghezza massima (in px) disponibile a una certa y (0..1)
      function tshirtWidthAt(t){
        // t: 0 top, 1 bottom
        // Sagoma semplificata:
        // - collo (strozzatura)
        // - spalle larghe
        // - maniche (più larghe nella parte alta)
        // - corpo più stretto
        // - base quasi piena
        const max = W;
        const body = max * 0.62;       // corpo centrale
        const shoulders = max * 0.92;  // spalle
        const sleeves = max * 0.98;    // picco maniche

        if (t < 0.10) {
          // collo: da stretto a spalle
          const neck = max * 0.28;
          const k = t / 0.10;
          // curva morbida
          return neck + (shoulders - neck) * (k*k*(3-2*k));
        }

        if (t < 0.26) {
          // maniche/spalle: sale verso sleeves e poi scende
          const k = (t - 0.10) / 0.16; // 0..1
          const peak = sleeves;
          const start = shoulders;
          const end = body * 0.92;
          // gobba
          const hump = start + (peak - start) * Math.sin(Math.PI * k);
          return hump * (1 - k*0.25) + end * (k*0.25);
        }

        if (t < 0.82) {
          // corpo: quasi rettangolo, leggero taper
          const k = (t - 0.26) / 0.56;
          const topBody = body * 0.98;
          const bottomBody = body * 1.03;
          return topBody + (bottomBody - topBody) * k;
        }

        // base: un filo più larga
        const k = (t - 0.82) / 0.18;
        return (body * 1.03) + (body * 1.10 - body * 1.03) * (k*k*(3-2*k));
      }

      function buildLines() {
        outEl.innerHTML = "";
        outEl.style.setProperty('--shape-fs', `${fs}px`);
        outEl.style.setProperty('--shape-lh', `${lh}px`);

        const linesCount = Math.floor(H / lh);
        let idx = 0;

        for (let i = 0; i < linesCount; i++) {
          const t = (i + 0.5) / linesCount; // 0..1
          const maxW = tshirtWidthAt(t);

          const div = document.createElement('div');
          div.className = 'shape-line';
          div.style.width = `${maxW}px`;

          // righe troppo strette = vuote (collo)
          if (maxW < fs * 3.2) {
            div.innerHTML = "&nbsp;";
            outEl.appendChild(div);
            continue;
          }

          let lineWords = [];
          while (idx < words.length) {
            const candidate = lineWords.length ? [...lineWords, words[idx]] : [words[idx]];
            const candidateStr = candidate.join(' ');
            if (measure(candidateStr, fs) <= maxW) {
              lineWords = candidate;
              idx++;
            } else break;
          }

          if (!lineWords.length && idx < words.length) {
            lineWords = [words[idx++]];
          }

          const str = lineWords.join(' ');
          const spaces = Math.max(0, lineWords.length - 1);

          // giustifica (word-spacing) per far arrivare la riga verso i bordi -> sagoma più netta
          if (spaces >= 2 && idx < words.length) {
            const rawW = measure(str, fs);
            const diff = maxW - rawW;
            const ws = Math.max(0, Math.min(5, diff / spaces));
            div.style.wordSpacing = `${ws}px`;
          } else {
            div.style.wordSpacing = '0px';
          }

          div.textContent = str;
          outEl.appendChild(div);

          // se abbiamo finito il testo, riempi con righe vuote (per completare sagoma)
          if (idx >= words.length) {
            for (let j = i + 1; j < linesCount; j++) {
              const t2 = (j + 0.5) / linesCount;
              const w2 = tshirtWidthAt(t2);
              const filler = document.createElement('div');
              filler.className = 'shape-line';
              filler.style.width = `${w2}px`;
              filler.innerHTML = "&nbsp;";
              outEl.appendChild(filler);
            }
            break;
          }
        }

        return idx >= words.length;
      }

      // Auto-fit semplice: se non entra, riduci leggermente fs/lh
      for (let tries = 0; tries < 20; tries++) {
        const ok = buildLines();
        if (ok) break;
        fs = Math.max(9.75, fs - 0.25);
        lh = Math.max(fs + 1.6, lh - 0.20);
      }
    })();

    // ------------------------------------------------------------
    // Filtri + connector (come prima)
    // ------------------------------------------------------------
    (function filtersAndConnector() {
      const state = { category: 'Journalism', tag: 'Fashion' };
      const categoryGroup = document.getElementById('categoryGroup');
      const tagGroup = document.getElementById('tagGroup');
      const path = document.getElementById('filterConnectorPath');
      const stackEl = document.getElementById('filterStack');

      const normTags = (raw) => (raw || '').split(',').map(s => s.trim()).filter(Boolean);

      const setActive = (groupEl, value) => {
        groupEl.querySelectorAll('.pill').forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.filter === value);
        });
      };

      const updateList = () => {
        document.querySelectorAll('.work-row').forEach((row) => {
          const c = row.getAttribute('data-category') || '';
          const tags = normTags(row.getAttribute('data-tags'));
          row.style.display = (c === state.category && tags.includes(state.tag)) ? '' : 'none';
        });
      };

      const onClick = (groupEl, key) => {
        groupEl.addEventListener('click', (e) => {
          const btn = e.target.closest('button[data-filter]');
          if (!btn) return;
          state[key] = btn.dataset.filter;
          setActive(groupEl, state[key]);
          updateList();
          drawConnector();
        });
      };

      function centerOf(el) {
        const r = el.getBoundingClientRect();
        return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
      }

      function drawConnector() {
        const a = categoryGroup.querySelector('.pill.is-active');
        const b = tagGroup.querySelector('.pill.is-active');
        if (!a || !b) { path.setAttribute('d', ''); return; }

        const fr = stackEl.getBoundingClientRect();
        const p1 = centerOf(a);
        const p2 = centerOf(b);

        const x1 = ((p1.x - fr.left) / fr.width) * 100;
        const y1 = ((p1.y - fr.top) / fr.height) * 100;
        const x2 = ((p2.x - fr.left) / fr.width) * 100;
        const y2 = ((p2.y - fr.top) / fr.height) * 100;

        const midY = (y1 + y2) / 2;
        const midX = (x1 + x2) / 2;

        const d = `
          M ${x1} ${y1}
          C ${x1 + 8} ${midY - 12},
            ${midX - 14} ${midY + 12},
            ${midX} ${midY}
          C ${midX + 14} ${midY - 12},
            ${x2 - 8} ${midY + 12},
            ${x2} ${y2}
        `;
        path.setAttribute('d', d);
      }

      onClick(categoryGroup, 'category');
      onClick(tagGroup, 'tag');

      setActive(categoryGroup, state.category);
      setActive(tagGroup, state.tag);
      updateList();
      drawConnector();

      window.addEventListener('resize', drawConnector);
    })();
  </script>

</body>
</html>
